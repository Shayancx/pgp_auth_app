#!/usr/bin/env ruby
# frozen_string_literal: true

puts 'ğŸ¥ Health Check for PGP Auth App'
puts '================================'

# Check PostgreSQL
begin
  require 'pg'
  conn = PG.connect(dbname: 'postgres')
  puts 'âœ… PostgreSQL: Connected'
  conn.close
rescue StandardError => e
  puts "âŒ PostgreSQL: #{e.message}"
end

# Check if database exists
begin
  require 'pg'
  conn = PG.connect(dbname: 'pgp_auth_app')
  puts 'âœ… Database: pgp_auth_app exists'
  conn.close
rescue StandardError => e
  puts "âŒ Database: #{e.message}"
end

# Check if all gems are available
begin
  require 'bundler/setup'
  puts 'âœ… Bundler: All gems available'
rescue StandardError => e
  puts "âŒ Bundler: #{e.message}"
end

# Check specific gems
%w[roda sequel bcrypt gpgme].each do |gem_name|
  require gem_name
  puts "âœ… Gem #{gem_name}: Available"
rescue StandardError => e
  puts "âŒ Gem #{gem_name}: #{e.message}"
end

puts ''
puts "If you see any âŒ above, run './bin/setup' to fix issues"
